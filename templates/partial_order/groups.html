{% extends 'partial_order/partial_order_processing.html' %}
{% load mathfilters %}

{% block script %}
    <script type="text/javascript" src="https://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript" src="https://d3js.org/d3-polygon.v2.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script type="text/javascript" src="../../static/js/utilities.js" defer></script>
    <script type="text/javascript" src="../../static/js/partialOrders.js" defer></script>
    <script type="text/javascript">

        let ids = ["groups_tab", "combinations_tab", "delays_tab", "final_tab"];
        ids.forEach(function (id) {
            let element = document.getElementById(id);
            element.classList.remove("active");
        });
        let element = document.getElementById("groups_tab");
        element.classList.add("active");

    </script>

{% endblock %}

{% block tab_content %}

    <div class="tab-pane fade show active">
        <div class="form-row justify-content-center info-row">
            <div class="col">
                <h4 class="mt-4 tab-headline">Please select a Partial Order Group</h4>
            </div>
            <div class="col mt-3">
                <button type="button" class="btn btn-info float-right" data-toggle="modal"
                        data-target="#exampleModalLong">Info
                </button>
            </div>
        </div>
        <br>

        {% if log_name != ':notset:' %}
            <p class="text-success info-subtitle"><b>'{{ log_name }}' is being used as the input.</b></p>
        {% else %}
            <p class="text-danger info-subtitle"><b>You have not set any event log as input. Use the "Event Data" tab
                to set an event log as input!</b></p>
        {% endif %}

        {% csrf_token %}

        <br>
        {% if log_name != ':notset:' %}
            <div class="spinner-border text-primary" id="spinner"></div>
            <div class="partial-order-groups" hidden>
                {% for group in groups %}
                    <div class="container-fluid">
                        <div class="row flex-nowrap partial-order-row partial-order-group">
                            <div class="col-1 align-self-center case-info">
                                <div class="row">
                                    <div class="col-12 inner-case-info">
                                        {{ group.numberOfCases }} {{ group.numberOfCases|pluralize:"case,cases" }}
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12 inner-case-info">
                                        <!-- Fraction of cases is multiplied by 100 to get the percentage value and rounded to 2 decimal places -->
                                        {{ group.numberOfCases |div:totalNumberOfTraces|mul:100|floatformat:2 }} % of
                                        the
                                        log
                                    </div>
                                </div>
                            </div>
                            <div class="col-11 align-self-center">
                                <div class="scrollable-inner">
                                    <div class="polygon" id="partial-order-{{ forloop.counter0 }}"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <!-- Info Popup Section -->
    <div class="modal fade bd-example-modal-lg" id="exampleModalLong" tabindex="-1" role="dialog"
         aria-labelledby="exampleModalLongTitle" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Partial Order Combinations</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h6>What is a Partial Order Group?</h6>
                    <p class="info"> A partial order group is a group that consists of all the traces of the event
                        log which have the same set of activities and are partial orders. We use the chevron style
                        for visualizing these activities (shape of the activities).
                        <br>
                        If an activity 'A' is followed by 'B' in the
                        visualization, it means 'B' occurred after 'A'. The ordering of activities that do not cause
                        the trace to become a partial order is retained as it is. The activities that have the same
                        time stamps and hence cause the trace to become a partial order are stacked on top of each
                        other, since an ordering cannot be decided. A 'Partial Order Group' contains all such traces
                        that have the same activities.
                        <b>Example:</b>
                        <br>
                        <!--todo: add table and images -->
                    </p>
                </div>
            </div>
        </div>
    </div>

{% endblock %}